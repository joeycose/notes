import argparse
import socket


def parse_arguments():
    parser = argparse.ArgumentParser(description="Lottery Ticket Client")
    parser.add_argument("ipv6_address", help="IPv6 address of the server")
    parser.add_argument("port", type=int, help="TCP port where the server is listening")
    parser.add_argument("-t", "--ticket_type", choices=[
                        "LOTTO_MAX", "LOTTO_6/49", "LOTTARIO"], required=True, help="Type of lottery ticket to request")
    parser.add_argument("-s", "--sets", type=int, default=1, help="Number of sets to generate")
    args = parser.parse_args()
    if not (1 <= args.port <= 65535):
        parser.error("Invalid port number")

    return args

def request_ticket(ipv6_address, port, ticket_type, sets):
    client = socket.socket(socket.AF_INET6, socket.SOCK_STREAM)
    client.connect((ipv6_address, port))

    request_data = f"{ticket_type} {sets}"
    client.send(request_data.encode("utf-8"))

    response_data = client.recv(1024).decode("utf-8")
    ticket_sets = response_data.strip().split('\n')

    client.close()

    return ticket_sets

def main():
    args = parse_arguments()
    ipv6_address = args.ipv6_address
    port = args.port
    ticket_type = args.ticket_type
    sets = args.sets

    ticket_sets = request_ticket(ipv6_address, port, ticket_type, sets)

    for ticket_str in ticket_sets:
        ticket_numbers = ticket_str.strip().split(',')
        ticket_array = f"[{', '.join(ticket_numbers)}]"
        print(ticket_array)


if __name__ == "__main__":
    main()
